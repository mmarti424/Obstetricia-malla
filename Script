let ramosAprobados = JSON.parse(localStorage.getItem("ramosAprobados")) || [];

function renderMalla(malla) {
  const contenedor = document.getElementById("contenedor-malla");
  contenedor.innerHTML = "";

  Object.entries(malla).forEach(([semestre, ramos]) => {
    const divSemestre = document.createElement("div");
    divSemestre.className = "semestre";
    divSemestre.innerHTML = `<h2>${semestre}</h2>`;

    ramos.forEach(r => {
      const divRamo = document.createElement("div");
      divRamo.className = "ramo";
      divRamo.textContent = r.nombre;
      divRamo.dataset.id = r.id;

      const requisitos = r.req || [];
      const aprobados = requisitos.every(req => ramosAprobados.includes(req));

      if (ramosAprobados.includes(r.id)) {
        divRamo.classList.add("tachado");
      } else if (!aprobados && requisitos.length > 0) {
        divRamo.classList.add("bloqueado");
      } else {
        divRamo.onclick = () => {
          ramosAprobados.push(r.id);
          localStorage.setItem("ramosAprobados", JSON.stringify(ramosAprobados));
          renderMalla(malla);
        };
      }

      divSemestre.appendChild(divRamo);
    });

    contenedor.appendChild(divSemestre);
  });
}

fetch("malla.json")
  .then(res => res.json())
  .then(data => renderMalla(data));
